"use strict";(self.webpackChunkapp_efnol=self.webpackChunkapp_efnol||[]).push([[703],{2703:(dt,z,r)=>{r.r(z),r.d(z,{ProcessingModule:()=>D});var A=r(6895),I=r(6551),m=r(3050),l=r(655),j=r(7579),B=r(4128),C=r(7272),Y=r(7359),N=r(4482);const K=(n,t)=>(n.push(t),n);function $(){return(0,N.e)((n,t)=>{(function J(n,t){return(0,N.e)((0,Y.U)(n,t,arguments.length>=2,!1,!0))})(K,[])(n).subscribe(t)})}var x=r(5698),T=r(4004),U=r(262),L=r(9646),X=r(2722),g=r(5342),V=r(4253),b=r(3905),H=r(3828),k=r(2048),w=r(1135),q=r(9751),R=r(8421);const{isArray:_}=Array;var et=r(5403);var M=r(5963),rt=r(4986),ot=r(4351),at=r(9300),ct=r(1365),F=r(3900),O=r(2843),W=r(8505),pt=r(6921),G=r(6377),s=r(1571),Q=r(7746),mt=r(5180);class u{constructor(t){this.kinHttpWrapper=t}getUrl(t){return`${this.appContext.apiRoot.claims}/v2/notices/claims/${t}/agreements`}postClaimAgreements(t,e){const i={agreements:t};return this.kinHttpWrapper.post(this.getUrl(e),i)}}u.\u0275fac=function(t){return new(t||u)(s.LFG(m.Mp))},u.\u0275prov=s.Yz7({token:u,factory:u.\u0275fac,providedIn:"root"}),(0,l.gn)([(0,g.l)()],u.prototype,"appContext",void 0);class h{constructor(t){this.kinHttpWrapper=t}getUrl(t){return`${this.appContext.apiRoot.claims}/v2/notices/claims/${t}/possession_damages`}postPossessionDamage(t,e){return this.kinHttpWrapper.post(this.getUrl(e),t)}putPossessionDamage(t,e,i){return this.kinHttpWrapper.put(`${this.getUrl(i)}/${t}`,e)}deletePossessionDamage(t,e){return this.kinHttpWrapper.delete(`${this.getUrl(e)}/${t}`)}}h.\u0275fac=function(t){return new(t||h)(s.LFG(m.Mp))},h.\u0275prov=s.Yz7({token:h,factory:h.\u0275fac,providedIn:"root"}),(0,l.gn)([(0,g.l)()],h.prototype,"appContext",void 0);class d{constructor(t){this.kinHttpWrapper=t}getUrl(t){return`${this.appContext.apiRoot.claims}/v2/notices/claims/${t}/structure_damages`}postStructureDamage(t,e){return this.kinHttpWrapper.post(this.getUrl(e),t)}}d.\u0275fac=function(t){return new(t||d)(s.LFG(m.Mp))},d.\u0275prov=s.Yz7({token:d,factory:d.\u0275fac,providedIn:"root"}),(0,l.gn)([(0,g.l)()],d.prototype,"appContext",void 0);class v{constructor(t){this.kinHttpWrapper=t}getUrl(t){return`${this.appContext.apiRoot.claims}/v2/notices/claims/${t}/attachments`}getPresignedURL(t,e){return this.kinHttpWrapper.get(`${this.getUrl(e)}/new`,!1,t)}postAttachment(t,e){return this.kinHttpWrapper.post(this.getUrl(e),t)}deleteAttachment(t,e){return this.kinHttpWrapper.delete(`${this.getUrl(e)}/${t.id}`)}putAttachmentToS3(t,e){return this.kinHttpWrapper.put(t,e)}}v.\u0275fac=function(t){return new(t||v)(s.LFG(m.Mp))},v.\u0275prov=s.Yz7({token:v,factory:v.\u0275fac,providedIn:"root"}),(0,l.gn)([(0,g.l)()],v.prototype,"appContext",void 0);class f{constructor(t){this.kinHttpWrapper=t}getUrl(t){return`${this.appContext.apiRoot.claims}/v2/notices/claims/${t}/damages`}postDamages(t,e){return this.kinHttpWrapper.post(this.getUrl(e),t)}}f.\u0275fac=function(t){return new(t||f)(s.LFG(m.Mp))},f.\u0275prov=s.Yz7({token:f,factory:f.\u0275fac,providedIn:"root"}),(0,l.gn)([(0,g.l)()],f.prototype,"appContext",void 0);class y{constructor(t){this.kinHttpWrapper=t}getUrl(t){return`${this.appContext.apiRoot.claims}/v2/notices/claims/${t}/emergency_responses`}post(t,e){return this.kinHttpWrapper.post(this.getUrl(e),t)}}y.\u0275fac=function(t){return new(t||y)(s.LFG(m.Mp))},y.\u0275prov=s.Yz7({token:y,factory:y.\u0275fac,providedIn:"root"}),(0,l.gn)([(0,g.l)()],y.prototype,"appContext",void 0);class Z{}class E{constructor(t){this.Error=t}}class P{constructor(t,e,i,o,a,c,p,ht){this.store=t,this.claimsService=e,this.agreementsService=i,this.possessionDamagesService=o,this.structureDamagesService=a,this.attachmentsService=c,this.damagesService=p,this.emergencyResponsesService=ht,this.POLL_TIMEOUT_MS=3e4,this.POLL_INTERVAL_MS=1e3,this.submitDataAndFinalizeProgressSubject$=new w.X({done:0,total:0}),this.submitDataAndFinalizeProgress$=this.submitDataAndFinalizeProgressSubject$.asObservable()}pollForClaimNumber(){return function st(...n){return 1===(n=function tt(n){return 1===n.length&&_(n[0])?n[0]:n}(n)).length?(0,R.Xf)(n[0]):new q.y(function nt(n){return t=>{let e=[];for(let i=0;e&&!t.closed&&i<n.length;i++)e.push((0,R.Xf)(n[i]).subscribe((0,et.x)(t,o=>{if(e){for(let a=0;a<e.length;a++)a!==i&&e[a].unsubscribe();e=null}t.next(o)})))}}(n))}((0,M.H)(this.POLL_TIMEOUT_MS).pipe((0,T.U)(()=>new Z)),function it(n=0,t=rt.z){return n<0&&(n=0),(0,M.H)(n,n,t)}(this.POLL_INTERVAL_MS).pipe((0,ot.b)(()=>this.claimsService.getClaim(this.claimNoticeId).pipe((0,U.K)(()=>(0,L.of)("oops")))),(0,at.h)(t=>"string"!=typeof t&&null!=t.claim.claimNumber),(0,x.q)(1)))}startClaimSubmission(){return this.store.select(G.Pp).pipe((0,ct.M)(this.store.select(H.wO)),(0,x.q)(1),(0,F.w)(([t,e])=>(this.claimNoticeId=e,JSON.stringify(t)===JSON.stringify(pt.C)?(0,O._)(()=>"claim data is missing and cannot be processed"):null==t.agreements||0===t.agreements.length?(0,O._)(()=>"agreements are missing so claim cannot be processed"):this.submitDataAndFinalize({prerequisites:this.buildRequests(t),final:this.agreementsService.postClaimAgreements(t.agreements,this.claimNoticeId)}))))}submitDataAndFinalize({prerequisites:t,final:e}){return this.initSubmitProgress(t.length+1),(0,C.z)(...t.map(i=>i.pipe((0,U.K)(o=>(0,L.of)(new E(o)))))).pipe((0,W.b)(()=>{this.incrementSubmitProgress()}),$(),(0,F.w)(i=>{const o=i.filter(a=>a instanceof E);return o.length>0?(0,O._)(()=>o):e.pipe((0,W.b)(()=>{this.incrementSubmitProgress()}))}))}initSubmitProgress(t){this.submitDataAndFinalizeProgressSubject$.next({done:0,total:t})}incrementSubmitProgress(){const{value:{done:t,total:e}}=this.submitDataAndFinalizeProgressSubject$;this.submitDataAndFinalizeProgressSubject$.next({done:t+1,total:e})}buildRequests(t){const{wasThirdPartyDamaged:e,thirdPartyDamageDetails:i,photos:o}=t;return[...this.whatWasDamagedToNoticesDamagesAPI(t),...this.emergencyResponseAPI(t),...e?[...this.damageDetailsToPostPossessionDamageAPI(i),...this.damageDetailsToPostStructureAPI(i)]:[],this.store.select(G.t$).pipe((0,x.q)(1),(0,F.w)(a=>this.claimsService.putClaim(a,this.claimNoticeId))),...this.photosToAttachmentsAPI(o)]}damageDetailsToPostPossessionDamageAPI(t){return null==t?[]:t.filter(e=>"personal"===e.type).map(e=>this.possessionDamagesService.postPossessionDamage({propertyDescription:e.propertyDescription??"",lossDescription:e.damageDescription??""},this.claimNoticeId))}damageDetailsToPostStructureAPI(t){return null==t?[]:t.filter(e=>"building"===e.type).map(e=>{const{display:i,...o}=e.propertyDescription;return this.structureDamagesService.postStructureDamage({...o,lossDescription:e.damageDescription??""},this.claimNoticeId)})}photosToAttachmentsAPI(t){return null==t?[]:t.map(e=>this.attachmentsService.getPresignedURL({fileName:e.name},this.claimNoticeId).pipe((0,F.w)(({attachment:i})=>(0,C.z)(this.attachmentsService.putAttachmentToS3(i.url,e),this.attachmentsService.postAttachment({uuid:i.uuid,fileName:e.name,type:"damage_documentation"},this.claimNoticeId)).pipe($()))))}whatWasDamagedToNoticesDamagesAPI(t){const i=t.exteriorDamages??[],o=t.personalPropertyDamages??[],a=t.otherLosses??[],c=[...(t.interiorDamages??[]).map(p=>({damageArea:"interior",damageAreaDescription:p})),...i.map(p=>({damageArea:"exterior",damageAreaDescription:p})),...o.map(p=>({damageArea:"personal_property",damageAreaDescription:p})),...a.map(p=>({damageArea:"other_losses",damageAreaDescription:p}))];return c.length>0?[this.damagesService.postDamages({damages:c},this.claimNoticeId)]:[]}emergencyResponseAPI({homeIsLivable:t,homeIsLivableDetail:e,needsEmergencyServices:i,needsEmergencyServicesDetail:o,assignVendorNow:a}){const c=[];return null!=t&&c.push({emergencyQuestion:"home_is_livable",emergencyQuestionOption:t?"yes":"no"}),e?.forEach(p=>{c.push({emergencyQuestion:"what_makes_home_unlivable",emergencyQuestionOption:p})}),null!=i&&(!0===i&&null!=o?o.forEach(p=>{c.push({emergencyQuestion:"needs_emergency_services",emergencyQuestionOption:p})}):c.push(!1===i?{emergencyQuestion:"needs_emergency_services",emergencyQuestionOption:"no"}:{emergencyQuestion:"needs_emergency_services",emergencyQuestionOption:"yes"})),null!=a&&c.push({emergencyQuestion:"assign_vendor_now",emergencyQuestionOption:a?"yes":"no"}),c.length>0?[this.emergencyResponsesService.post({emergencyResponses:c},this.claimNoticeId)]:[]}}P.\u0275fac=function(t){return new(t||P)(s.LFG(Q.yh),s.LFG(mt.U),s.LFG(u),s.LFG(h),s.LFG(d),s.LFG(v),s.LFG(f),s.LFG(y))},P.\u0275prov=s.Yz7({token:P,factory:P.\u0275fac,providedIn:"root"});var lt=r(2940);function gt(n,t){if(1&n&&(s.ynx(0),s._UZ(1,"div",5),s.TgZ(2,"p",3),s._uU(3),s.ALo(4,"percent"),s.qZA(),s.BQk()),2&n){const e=t.ngIf;s.xp6(3),s.hij(" ",s.lcZ(4,1,e.done/e.total)," ")}}class S{onBeforeUnload(t){"local"!==this.appContext.environment&&(t.preventDefault(),t.returnValue="")}constructor(t,e,i){this.store=t,this.router=e,this.processingService=i,this.spinnerIcon="house",this.destroy$=new j.x,this.submitDataAndFinalizeProgress$=this.processingService.submitDataAndFinalizeProgress$}ngOnInit(){(0,B.D)((0,C.z)(this.processingService.startClaimSubmission(),this.processingService.pollForClaimNumber()).pipe($()),this.store.select(H.WO).pipe((0,x.q)(1),(0,T.U)(t=>this.appContext.persona.type===V.Fz.KIN_AGENT?t:void 0),(0,U.K)(t=>(console.error(t),(0,L.of)(void 0))))).pipe((0,X.R)(this.destroy$)).subscribe({next:([[t,e],i])=>{this.store.dispatch((0,b.ot)()),this.router.navigate(["success"],e instanceof Z?{queryParams:{policyNumber:i}}:{queryParams:{claimNumber:e.claim.claimNumber,policyNumber:i}})},error:()=>{this.store.dispatch((0,b.hl)()),this.router.navigateByUrl("/help",{state:{ejectionType:k.A.submissionError}})}})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}}S.\u0275fac=function(t){return new(t||S)(s.Y36(Q.yh),s.Y36(I.F0),s.Y36(P))},S.\u0275cmp=s.Xpm({type:S,selectors:[["app-kin-processing"]],hostBindings:function(t,e){1&t&&s.NdJ("beforeunload",function(o){return e.onBeforeUnload(o)},!1,s.Jf7)},decls:8,vars:4,consts:[[1,"spinner","vr__x8","vr__x20@medium"],[3,"iconName"],[1,"text","vr__x2"],[1,"text","text__brand-gray"],[4,"ngIf"],[1,"vr__x2"]],template:function(t,e){1&t&&(s.TgZ(0,"div",0),s._UZ(1,"ngk-spinner",1),s.qZA(),s.TgZ(2,"h1",2),s._uU(3," Submitting your claim...\n"),s.qZA(),s.TgZ(4,"p",3),s._uU(5," This will only take a moment.\n"),s.qZA(),s.YNc(6,gt,5,3,"ng-container",4),s.ALo(7,"async")),2&t&&(s.xp6(1),s.Q6J("iconName",e.spinnerIcon),s.xp6(5),s.Q6J("ngIf",s.lcZ(7,2,e.submitDataAndFinalizeProgress$)))},dependencies:[A.O5,lt.O,A.Ov,A.Zx],styles:["[_nghost-%COMP%]{padding:1.5rem;max-width:96rem;margin:0 auto;display:flex;flex-direction:column;align-items:center}@media only screen and (min-width: 992px){[_nghost-%COMP%]{padding:4.375rem 1.5rem 1.5rem}}.spinner[_ngcontent-%COMP%]{width:150px;height:150px}"],changeDetection:0}),(0,l.gn)([(0,g.l)()],S.prototype,"appContext",void 0);const ut=[{path:"",component:S}];class D{}D.\u0275fac=function(t){return new(t||D)},D.\u0275mod=s.oAB({type:D}),D.\u0275inj=s.cJS({imports:[A.ez,I.Bz.forChild(ut),m.OR,I.Bz]})}}]);